#=======================================================================
#基本設定
#=======================================================================
# 環境変数
export LANG=ja_JP.UTF-8

#-----------------------------------------------------------------------
#色彩関連の設定
#-----------------------------------------------------------------------
# 色を使用出来るようにする
autoload colors
colors

### Ls Color ###
# 色の設定
### Prompt ####
# 2行表示
PROMPT="%{${fg[green]}%}[%n@%m] %{${fg[cyan]}%}%~
%{${reset_color}%}%# "
# vim/emacsキーバインドにする
bindkey -v #-e

#--------------------------------------------------
# ヒストリの設定
#--------------------------------------------------

HISTFILE=~/.zsh_history
HISTSIZE=100000
SAVEHIST=100000
setopt bang_hist          # !を使ったヒストリ展開を行う(d)
setopt extended_history   # ヒストリに実行時間も保存する
setopt hist_ignore_dups   # 直前と同じコマンドはヒストリに追加しない
setopt share_history      # 他のシェルのヒストリをリアルタイムで共有する
setopt hist_reduce_blanks # 余分なスペースを削除してヒストリに保存する
# マッチしたコマンドのヒストリを表示できるようにする
autoload history-search-end
zle -N history-beginning-search-backward-end history-search-end
zle -N history-beginning-search-forward-end history-search-end
bindkey "^P" history-beginning-search-backward-end
bindkey "^N" history-beginning-search-forward-end

# すべてのヒストリを表示する
function history-all { history -E 1 }

#--------------------------------------------------
# オプション
# 日本語ファイル名を表示可能にする
setopt print_eight_bit
 
# beep を無効にする
setopt no_beep
 
# フローコントロールを無効にする
setopt no_flow_control
 
# Ctrl+Dでzshを終了しない
setopt ignore_eof
 
# '#' 以降をコメントとして扱う
setopt interactive_comments
 
# ディレクトリ名だけでcdする
setopt auto_cd
 
# cd したら自動的にpushdする
setopt auto_pushd
# 重複したディレクトリを追加しない
setopt pushd_ignore_dups
 
# 同時に起動したzshの間でヒストリを共有する
setopt share_history
 
# 同じコマンドをヒストリに残さない
setopt hist_ignore_all_dups
 
# スペースから始まるコマンド行はヒストリに残さない
setopt hist_ignore_space
 
# ヒストリに保存するときに余分なスペースを削除する
setopt hist_reduce_blanks
 
# 高機能なワイルドカード展開を使用する
setopt extended_glob
 
#--------------------------------------------------
# キーバインド
 
# ^R で履歴検索をするときに * でワイルドカードを使用出来るようにする
bindkey '^R' history-incremental-pattern-search-backward
 
#--------------------------------------------------
# エイリアス

alias la='ls -a'
alias ll='ls -l'
alias mkdir='mkdir -p'
alias cd...='cd ../../'
alias cd....='cd ../../../'

alias v='vim'
 
# sudo の後のコマンドでエイリアスを有効にする
alias sudo='sudo '
 
# グローバルエイリアス
alias -g L='| less'
alias -g G='| grep'

#=======================================================================
#補完機能の設定
#=======================================================================
# 補完機能を有効にする
autoload -Uz compinit
compinit

# 補完で小文字でも大文字にマッチさせる
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'
 
# ../ の後は今いるディレクトリを補完しない
zstyle ':completion:*' ignore-parents parent pwd ..
 
# sudo の後ろでコマンド名を補完する
zstyle ':completion:*:sudo:*' command-path /usr/local/sbin /usr/local/bin \
                   /usr/sbin /usr/bin /sbin /bin /usr/X11R6/bin

### Complement ###
autoload -U compinit; compinit # 補完機能を有効にする
setopt auto_list               # 補完候補を一覧で表示する(d)
setopt auto_menu               # 補完キー連打で補完候補を順に表示する(d)
setopt list_packed             # 補完候補をできるだけ詰めて表示する
setopt list_types              # 補完候補にファイルの種類も表示する
bindkey "^[[Z" reverse-menu-complete  # Shift-Tabで補完候補を逆順する("\e[Z"でも動作する)
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}' # 補完時に大文字小文字を区別しない

#=======================================================================
# 高速なディレクトリ移動 
#  http://qiita.com/maxmellon/items/23325c22581e9187639e
#=======================================================================
#-----------------------------------------------------------------------
#zshのhistoryとpecoの連携
#function peco-select-history() {
#    local tac
#    if which tac > /dev/null; then
#        tac="tac"
#    else
#        tac="tail -r"
#    fi
#
#    BUFFER=$(\history -n 1 | \
#        eval $tac | \
#        peco --query "$LBUFFER")
#    CURSOR=$#BUFFER
#    zle clear-screen
#}
#zle -N peco-select-history
#bindkey '^r' peco-select-history
#
## ユーザーディレクトリ内にインストールした場合はPATHを設定
#PATH=$PATH:~/local/bin/
#export PATH=$PATH:~/local/bin/
#
##-----------------------------------------------------------------------
##ディレクトリ移動に際しての設定
#function peco-z-search
#{
#  which peco z > /dev/null
#  if [ $? -ne 0 ]; then
#    echo "Please install peco and z"
#    return 1
#  fi
#  local res=$(z | sort -rn | cut -c 12- | peco)
#  if [ -n "$res" ]; then
#    BUFFER+="cd $res"
#    zle accept-line
#  else
#    return 1
#  fi
#}
#zle -N peco-z-search
#bindkey '^f' peco-z-search

source ~/.zsh.d/z.sh

